/*!
 * # Semantic UI 2.0.0 - Video
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributorss
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
!function(e,t,n,o){"use strict";function a(e,t,n){return t<=e.length?e:a(t,n+e,n)}function s(e){var t=new Date(1e3*e),n=a(String(t.getHours()-1),1,"0")+":"+a(String(t.getMinutes()),2,"0")+":"+a(String(t.getSeconds()),2,"0");return n}e.fn.video=function(n){{var a,i=e(this),u=i.selector||"",l=(new Date).getTime(),r=[],c=arguments[0],m="string"==typeof c,d=[].slice.call(arguments,1);t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame||function(e){setTimeout(e,0)}}return i.each(function(){var p,g=e.isPlainObject(n)?e.extend(!0,{},e.fn.video.settings,n):e.extend({},e.fn.video.settings),f=(g.selector,g.className,g.error,g.metadata,g.namespace),v=(g.templates,"."+f),b="module-"+f,y=(e(t),e(this)),k=y.find(g.selector.video),R=y.find(g.selector.playButton),h=y.find(g.selector.seekButton),q=y.find(g.selector.currentTime),T=y.find(g.selector.remainingTime),C=y.find(g.selector.timeRange),N=y.find(g.selector.volumeUpButton),B=y.find(g.selector.volumeDownButton),w=y.find(g.selector.volumeProgress),U=y.find(g.selector.muteButton),A=!0,S=C.prop("max")-C.prop("min"),x=t.setTimeout(1,function(){}),D=o,F=this,P=k.get(0),j=y.data(b);p={initialize:function(){p.debug("Initializing video"),p.instantiate(),p.bind.events()},instantiate:function(){p.verbose("Storing instance of module",p),j=p,y.data(b,p)},bind:{events:function(){p.debug("Binding video module events"),k.on("play"+v+" playing"+v,p.activate.playButton).on("pause"+v+" ended"+v,p.deactivate.playButton).on("ratechange"+v,function(e){console.log(P.playbackRate)}).on("timeupdate"+v,p.update.time).on("loadstart"+v+" seeking"+v,p.update.loading).on("loadeddata"+v+" seeked"+v,p.update.loaded).on("volumechange"+v,p.update.volume),R.on("click"+v,p.request.playToggle),h.on("click"+v,p.request.seek.toRelativeTime).on("mousedown"+v,p.request.seek.tickLoop).on("mouseup"+v+"mouseleave"+v,p.request.seek.stopLoop),C.on("change"+v,p.request.seek.fromRangeValue).on("mousedown"+v,p.deactivate.timeRangeUpdate).on("mouseup"+v,p.activate.timeRangeUpdate),N.on("click"+v,p.request.volumeUp),B.on("click"+v,p.request.volumeDown),w.on("click"+v,p.request.unmute),U.on("click"+v,p.request.muteToggle)}},request:{playToggle:function(){return p.debug("Request play toggle"),P.paused?p.request.play():p.request.pause()},play:function(){return p.debug("Request play"),P.play()},pause:function(){return p.debug("Request pause"),P.pause()},playRate:function(){p.debug("Request playRate (from button data)"),P.playbackRate=parseFloat(e(this).data("play-rate"))},seek:{toAbsoluteTime:function(e){p.debug("Request time absolute seek"),P.fastSeek?P.fastSeek(e):P.currentTime=e},toRelativeTime:function(){p.debug("Request time relative seek from current position)"),console.log(e(this).data("seek-step"));var t=P.currentTime+e(this).data("seek-step");p.request.seek.toAbsoluteTime(t)},fromRangeValue:function(){p.debug("Request time seek from absolute range value");var e=C.val()/S,t=P.duration*e;p.request.seek.toAbsoluteTime(t)},tickLoop:function(){p.debug("Start seek loop"),t.clearTimeout(x),D===o?(D=!P.paused,p.request.pause()):p.request.seek.toRelativeTime.bind(this)(),x=t.setTimeout(p.request.seek.tickLoop.bind(this),parseInt(e(this).data("seek-interval")))},stopLoop:function(){p.debug("Stop seek loop"),t.clearTimeout(x),D&&p.request.play(),D=o}},volumeUp:function(){p.debug("Request volume up"),e(this).hasClass(g.className.disabled)?P.muted=!1:P.volume=Math.min(P.volume+g.volumeStep,1)},volumeDown:function(){p.debug("Request volume down"),e(this).hasClass(g.className.disabled)?P.muted=!1:P.volume=Math.max(P.volume-g.volumeStep,0)},mute:function(){p.debug("Request mute"),P.muted=!0},unmute:function(){p.debug("Request unmute"),P.muted=!1},muteToggle:function(){p.debug("Request mute toggle"),P.muted=!P.muted}},reset:{playRate:function(){p.debug("Reset play rate"),P.playbackRate=P.defaultPlaybackRate}},update:{time:function(){p.debug("Update time"),q.text(s(P.currentTime)),T.text(s(P.duration-P.currentTime)),A&&C.val(S*P.currentTime/P.duration)},loading:function(){p.debug("Update to loading state"),C.prop("disabled",!0).addClass(g.className.disabled)},loaded:function(){p.debug("Update to loaded state"),C.prop("disabled",!1).removeClass(g.className.disabled)},volume:function(){p.debug("Update volume and mute states"),P.muted?(N.addClass(g.className.disabled),B.addClass(g.className.disabled),w.addClass(g.className.disabled),U.addClass(g.className.active)):(N.removeClass(g.className.disabled),B.removeClass(g.className.disabled),w.removeClass(g.className.disabled),U.removeClass(g.className.active)),w.progress({percent:100*P.volume})}},activate:{playButton:function(){p.debug("Activate playButton"),R.addClass(g.className.active)},timeRangeUpdate:function(){p.debug("Activate timeRange autoupdate"),A=!0}},deactivate:{playButton:function(){p.debug("Deactivate playButton"),R.removeClass(g.className.active)},timeRangeUpdate:function(){p.debug("Deactivate timeRange autoupdate"),A=!1}},destroy:function(){p.verbose("Destroying previous instance of video"),k=null,p.reset(),y.removeData(b).off(v)},refresh:function(){p.verbose("Refreshing selector cache"),k=F},reset:function(){p.debug("Clearing video"),g.onReset()},setting:function(t,n){if(p.debug("Changing setting",t,n),e.isPlainObject(t))e.extend(!0,g,t);else{if(n===o)return g[t];g[t]=n}},internal:function(t,n){if(e.isPlainObject(t))e.extend(!0,p,t);else{if(n===o)return p[t];p[t]=n}},debug:function(){g.debug&&(g.performance?p.performance.log(arguments):(p.debug=Function.prototype.bind.call(console.info,console,g.name+":"),p.debug.apply(console,arguments)))},verbose:function(){g.verbose&&g.debug&&(g.performance?p.performance.log(arguments):(p.verbose=Function.prototype.bind.call(console.info,console,g.name+":"),p.verbose.apply(console,arguments)))},error:function(){p.error=Function.prototype.bind.call(console.error,console,g.name+":"),p.error.apply(console,arguments)},performance:{log:function(e){var t,n,o;g.performance&&(t=(new Date).getTime(),o=l||t,n=t-o,l=t,r.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:F,"Execution Time":n})),clearTimeout(p.performance.timer),p.performance.timer=setTimeout(p.performance.display,500)},display:function(){var t=g.name+":",n=0;l=!1,clearTimeout(p.performance.timer),e.each(r,function(e,t){n+=t["Execution Time"]}),t+=" "+n+"ms",u&&(t+=" '"+u+"'"),i.length>1&&(t+=" ("+i.length+")"),(console.group!==o||console.table!==o)&&r.length>0&&(console.groupCollapsed(t),console.table?console.table(r):e.each(r,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),r=[]}},invoke:function(t,n,s){var i,u,l,r=j;return n=n||d,s=F||s,"string"==typeof t&&r!==o&&(t=t.split(/[\. ]/),i=t.length-1,e.each(t,function(n,a){var s=n!=i?a+t[n+1].charAt(0).toUpperCase()+t[n+1].slice(1):t;if(e.isPlainObject(r[s])&&n!=i)r=r[s];else{if(r[s]!==o)return u=r[s],!1;if(!e.isPlainObject(r[a])||n==i)return r[a]!==o?(u=r[a],!1):(p.error(t),!1);r=r[a]}})),e.isFunction(u)?l=u.apply(s,n):u!==o&&(l=u),e.isArray(a)?a.push(l):a!==o?a=[a,l]:l!==o&&(a=l),u}},m?(j===o&&p.initialize(),p.invoke(c)):(j!==o&&j.invoke("destroy"),p.initialize())}),a!==o?a:this},e.fn.video.settings={name:"Video",namespace:"video",debug:!0,verbose:!0,performance:!0,className:{active:"active",disabled:"disabled"},selector:{video:"video",playButton:".play.button",seekButton:".seek.button",currentTime:".current.time",remainingTime:".remaining.time",timeRange:'input[type="range"].time',volumeUpButton:".volume.up.button",volumeDownButton:".volume.down.button",volumeProgress:".volume.progress",muteButton:".mute.button"},volumeStep:.1}}(jQuery,window,document);