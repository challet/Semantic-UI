/*!
 * # Semantic UI 2.0.0 - Video
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributorss
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
!function(e,t,n,o){"use strict";function a(e,t,n){return t<=e.length?e:a(t,n+e,n)}function u(e){var t=new Date(1e3*e),n=a(String(t.getHours()-1),1,"0")+":"+a(String(t.getMinutes()),2,"0")+":"+a(String(t.getSeconds()),2,"0");return n}e.fn.video=function(n){{var a,i=e(this),s=i.selector||"",r=(new Date).getTime(),l=[],c=arguments[0],m="string"==typeof c,d=[].slice.call(arguments,1);t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame||function(e){setTimeout(e,0)}}return i.each(function(){var p,g=e.isPlainObject(n)?e.extend(!0,{},e.fn.video.settings,n):e.extend({},e.fn.video.settings),f=(g.selector,g.className,g.error,g.metadata,g.namespace),v=(g.templates,"."+f),b="module-"+f,k=(e(t),e(this)),y=k.find(g.selector.video),q=k.find(g.selector.playButton),R=k.find(g.selector.seekButton),T=k.find(g.selector.currentTime),h=k.find(g.selector.remainingTime),C=k.find(g.selector.timeRange),N=k.find(g.selector.volumeUpButton),B=k.find(g.selector.volumeDownButton),w=k.find(g.selector.volumeProgress),S=k.find(g.selector.muteButton),U=k.find(g.selector.rateInput),x=k.find(g.selector.rateReset),A=!0,D=C.prop("max")-C.prop("min"),F=t.setTimeout(1,function(){}),P=o,j=this,z=y.get(0),E=k.data(b);p={initialize:function(){p.debug("Initializing video"),p.instantiate(),p.bind.events(),p.initialValues()},instantiate:function(){p.verbose("Storing instance of module",p),E=p,k.data(b,p)},bind:{events:function(){p.debug("Binding video module events"),y.on("play"+v+" playing"+v+" pause"+v+" ended"+v,p.update.playState).on("ratechange"+v,p.update.rate).on("timeupdate"+v,p.update.time).on("loadstart"+v+" seeking"+v,p.update.loading).on("loadeddata"+v+" seeked"+v,p.update.loaded).on("volumechange"+v,p.update.volume),q.on("click"+v,p.request.playToggle),R.on("click"+v,p.request.seek.toRelativeTime).on("mousedown"+v,p.request.seek.tickLoop).on("mouseup"+v+"mouseleave"+v,p.request.seek.stopLoop),C.on("change"+v,p.request.seek.fromRangeValue).on("mousedown"+v,p.deactivate.timeRangeUpdate).on("mouseup"+v,p.activate.timeRangeUpdate),N.on("click"+v,p.request.volumeUp),B.on("click"+v,p.request.volumeDown),w.on("click"+v,p.request.unmute),S.on("click"+v,p.request.muteToggle),U.on("change"+v,p.request.rate),x.on("click"+v,function(){console.log("plop"),p.reset.rate()})}},initialValues:function(){p.update.playState(),p.update.time(),p.update.volume()},request:{playToggle:function(){return p.debug("Request play toggle"),z.paused?p.request.play():p.request.pause()},play:function(){return p.debug("Request play"),z.play()},pause:function(){return p.debug("Request pause"),z.pause()},rate:function(){p.debug("Request playBack rate (from button data)"),z.playbackRate=parseFloat(e(this).val())},seek:{toAbsoluteTime:function(e){p.debug("Request time absolute seek"),z.fastSeek?z.fastSeek(e):z.currentTime=e},toRelativeTime:function(){p.debug("Request time relative seek from current position)");var t=z.currentTime+e(this).data("seek-step");p.request.seek.toAbsoluteTime(t)},fromRangeValue:function(){p.debug("Request time seek from absolute range value");var e=C.val()/D,t=z.duration*e;p.request.seek.toAbsoluteTime(t)},tickLoop:function(){p.debug("Tick seek loop"),t.clearTimeout(F),P===o?(P=!z.paused,p.request.pause()):p.request.seek.toRelativeTime.bind(this)(),F=t.setTimeout(p.request.seek.tickLoop.bind(this),parseInt(e(this).data("seek-interval")))},stopLoop:function(){p.debug("Stop seek loop"),t.clearTimeout(F),P&&p.request.play(),P=o}},volumeUp:function(){z.muted?p.request.unmute():(p.debug("Request volume up"),z.volume=Math.min(z.volume+g.volumeStep,1))},volumeDown:function(){z.muted?p.request.unmute():(p.debug("Request volume down"),z.volume=Math.max(z.volume-g.volumeStep,0))},mute:function(){p.debug("Request mute"),z.muted=!0},unmute:function(){p.debug("Request unmute"),z.muted=!1},muteToggle:function(){p.debug("Request mute toggle"),z.muted=!z.muted}},reset:{rate:function(){p.debug("Reset playBack rate"),z.playbackRate=z.defaultPlaybackRate},all:function(){p.debug("Clearing video"),g.onReset()}},update:{playState:function(){p.debug("Deactivate playButton"),z.paused?q.removeClass(g.className.active):q.addClass(g.className.active)},time:function(){p.debug("Update time"),T.text(u(z.currentTime)),h.text(u(z.duration-z.currentTime)),A&&C.val(D*z.currentTime/z.duration)},loading:function(){p.debug("Update to loading state"),C.prop("disabled",!0).addClass(g.className.disabled)},loaded:function(){p.debug("Update to loaded state"),C.prop("disabled",!1).removeClass(g.className.disabled)},volume:function(){p.debug("Update volume and mute states"),z.muted?(N.addClass(g.className.disabled),B.addClass(g.className.disabled),w.addClass(g.className.disabled),S.addClass(g.className.active)):(N.removeClass(g.className.disabled),B.removeClass(g.className.disabled),w.removeClass(g.className.disabled),S.removeClass(g.className.active)),w.progress({percent:100*z.volume})},rate:function(){p.debug("Update playBack rate"),U.val(z.playbackRate)}},activate:{timeRangeUpdate:function(){p.debug("Activate timeRange autoupdate"),A=!0}},deactivate:{timeRangeUpdate:function(){p.debug("Deactivate timeRange autoupdate"),A=!1}},destroy:function(){p.verbose("Destroying previous instance of video"),y=null,p.reset(),k.removeData(b).off(v)},refresh:function(){p.verbose("Refreshing selector cache"),y=j},setting:function(t,n){if(p.debug("Changing setting",t,n),e.isPlainObject(t))e.extend(!0,g,t);else{if(n===o)return g[t];g[t]=n}},internal:function(t,n){if(e.isPlainObject(t))e.extend(!0,p,t);else{if(n===o)return p[t];p[t]=n}},debug:function(){g.debug&&(g.performance?p.performance.log(arguments):(p.debug=Function.prototype.bind.call(console.info,console,g.name+":"),p.debug.apply(console,arguments)))},verbose:function(){g.verbose&&g.debug&&(g.performance?p.performance.log(arguments):(p.verbose=Function.prototype.bind.call(console.info,console,g.name+":"),p.verbose.apply(console,arguments)))},error:function(){p.error=Function.prototype.bind.call(console.error,console,g.name+":"),p.error.apply(console,arguments)},performance:{log:function(e){var t,n,o;g.performance&&(t=(new Date).getTime(),o=r||t,n=t-o,r=t,l.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:j,"Execution Time":n})),clearTimeout(p.performance.timer),p.performance.timer=setTimeout(p.performance.display,500)},display:function(){var t=g.name+":",n=0;r=!1,clearTimeout(p.performance.timer),e.each(l,function(e,t){n+=t["Execution Time"]}),t+=" "+n+"ms",s&&(t+=" '"+s+"'"),i.length>1&&(t+=" ("+i.length+")"),(console.group!==o||console.table!==o)&&l.length>0&&(console.groupCollapsed(t),console.table?console.table(l):e.each(l,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),l=[]}},invoke:function(t,n,u){var i,s,r,l=E;return n=n||d,u=j||u,"string"==typeof t&&l!==o&&(t=t.split(/[\. ]/),i=t.length-1,e.each(t,function(n,a){var u=n!=i?a+t[n+1].charAt(0).toUpperCase()+t[n+1].slice(1):t;if(e.isPlainObject(l[u])&&n!=i)l=l[u];else{if(l[u]!==o)return s=l[u],!1;if(!e.isPlainObject(l[a])||n==i)return l[a]!==o?(s=l[a],!1):(p.error(t),!1);l=l[a]}})),e.isFunction(s)?r=s.apply(u,n):s!==o&&(r=s),e.isArray(a)?a.push(r):a!==o?a=[a,r]:r!==o&&(a=r),s}},m?(E===o&&p.initialize(),p.invoke(c)):(E!==o&&E.invoke("destroy"),p.initialize())}),a!==o?a:this},e.fn.video.settings={name:"Video",namespace:"video",debug:!0,verbose:!0,performance:!0,className:{active:"active",disabled:"disabled"},selector:{video:"video",playButton:".play.button",seekButton:".seek.button",currentTime:".current.time",remainingTime:".remaining.time",timeRange:'input[type="range"].time',volumeUpButton:".volume.up.button",volumeDownButton:".volume.down.button",volumeProgress:".volume.progress",muteButton:".mute.button",rateInput:'.rate input[type="number"]',rateReset:".rate .reset"},volumeStep:.1}}(jQuery,window,document);